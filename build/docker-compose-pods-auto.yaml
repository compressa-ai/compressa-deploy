networks:
  common_network:
    external: true
services:
  krok-compressa-0:
    command: python -m uvicorn manager.app.main:app --host 0.0.0.0 --port 5100
    container_name: krok-compressa-0
    deploy:
      resources:
        reservations:
          devices:
          - capabilities:
            - gpu
            device_ids:
            - '0'
            driver: nvidia
    environment:
      DISABLE_AUTODEPLOY: true
      DISPATCHER_HOST: dispatcher
      DISPATCHER_PORT: '8001'
      MINIO_URL: minio-s3:9000
      POD_ID: 0
      POD_NAME: krok-compressa
    image: compressa/compressa-pod:0.3.9.post1
    networks:
      common_network: {}
    restart: always
    shm_size: 32g
    volumes:
    - /data/shared/CompressaAI/test_deploy:/app/resources:rw
    - /data/shared/CompressaAI/k_cache:/home/compressa/.cache/:rw
  krok-compressa-1:
    command: python -m uvicorn manager.app.main:app --host 0.0.0.0 --port 5100
    container_name: krok-compressa-1
    deploy:
      resources:
        reservations:
          devices:
          - capabilities:
            - gpu
            device_ids:
            - '4'
            driver: nvidia
    environment:
      DISABLE_AUTODEPLOY: true
      DISPATCHER_HOST: dispatcher
      DISPATCHER_PORT: '8001'
      MINIO_URL: minio-s3:9000
      POD_ID: 1
      POD_NAME: krok-compressa
    image: compressa/compressa-pod:0.3.9.post1
    networks:
      common_network: {}
    restart: always
    shm_size: 32g
    volumes:
    - /data/shared/CompressaAI/test_deploy:/app/resources:rw
    - /data/shared/CompressaAI/k_cache:/home/compressa/.cache/:rw
  krok-compressa-2:
    command: python -m uvicorn manager.app.main:app --host 0.0.0.0 --port 5100
    container_name: krok-compressa-2
    deploy:
      resources:
        reservations:
          devices:
          - capabilities:
            - gpu
            device_ids:
            - '4'
            driver: nvidia
    environment:
      DISABLE_AUTODEPLOY: true
      DISPATCHER_HOST: dispatcher
      DISPATCHER_PORT: '8001'
      MINIO_URL: minio-s3:9000
      POD_ID: 2
      POD_NAME: krok-compressa
    image: compressa/compressa-pod:0.3.9.post1
    networks:
      common_network: {}
    restart: always
    shm_size: 32g
    volumes:
    - /data/shared/CompressaAI/test_deploy:/app/resources:rw
    - /data/shared/CompressaAI/k_cache:/home/compressa/.cache/:rw
  krok-compressa-3:
    command: python -m uvicorn manager.app.main:app --host 0.0.0.0 --port 5100
    container_name: krok-compressa-3
    deploy:
      resources:
        reservations:
          devices:
          - capabilities:
            - gpu
            device_ids:
            - '4'
            driver: nvidia
    environment:
      DISABLE_AUTODEPLOY: true
      DISPATCHER_HOST: dispatcher
      DISPATCHER_PORT: '8001'
      MINIO_URL: minio-s3:9000
      POD_ID: 3
      POD_NAME: krok-compressa
    image: compressa/compressa-pod:0.3.9.post1
    networks:
      common_network: {}
    restart: always
    shm_size: 32g
    volumes:
    - /data/shared/CompressaAI/test_deploy:/app/resources:rw
    - /data/shared/CompressaAI/k_cache:/home/compressa/.cache/:rw
  krok-compressa-4:
    command: python -m uvicorn manager.app.main:app --host 0.0.0.0 --port 5100
    container_name: krok-compressa-4
    deploy:
      resources:
        reservations:
          devices:
          - capabilities:
            - gpu
            device_ids:
            - '4'
            driver: nvidia
    environment:
      DISABLE_AUTODEPLOY: true
      DISPATCHER_HOST: dispatcher
      DISPATCHER_PORT: '8001'
      MINIO_URL: minio-s3:9000
      POD_ID: 4
      POD_NAME: krok-compressa
    image: compressa/compressa-pod:0.3.9.post1
    networks:
      common_network: {}
    restart: always
    shm_size: 32g
    volumes:
    - /data/shared/CompressaAI/test_deploy:/app/resources:rw
    - /data/shared/CompressaAI/k_cache:/home/compressa/.cache/:rw
  krok-compressa-5:
    command: python -m uvicorn manager.app.main:app --host 0.0.0.0 --port 5100
    container_name: krok-compressa-5
    deploy: {}
    environment:
      DISABLE_AUTODEPLOY: true
      DISPATCHER_HOST: dispatcher
      DISPATCHER_PORT: '8001'
      MINIO_URL: minio-s3:9000
      POD_ID: 5
      POD_NAME: krok-compressa
    image: compressa/compressa-pod:0.3.9.post1
    networks:
      common_network: {}
    restart: always
    shm_size: 32g
    volumes:
    - /data/shared/CompressaAI/test_deploy:/app/resources:rw
    - /data/shared/CompressaAI/k_cache:/home/compressa/.cache/:rw
version: '3.8'
volumes:
  aim_data: {}
  minio_data: {}
